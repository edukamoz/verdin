(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const L="verdin_auth_token",z=e=>{localStorage.setItem(L,e)},B=()=>localStorage.getItem(L),E=()=>{localStorage.removeItem(L)},F=()=>!!B(),K="https://verdin-api.onrender.com",l=async(e,t={})=>{const s=B(),d={"Content-Type":"application/json"};s&&(d.Authorization=`Bearer ${s}`);const o=await fetch(`${K}${e}`,{...t,headers:{...d,...t.headers}});if(!o.ok){const n=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(n.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},W=e=>l("/api/users/login",{method:"POST",body:JSON.stringify(e)}),Y=e=>l("/api/users/register",{method:"POST",body:JSON.stringify(e)}),Z=()=>l("/api/transactions"),G=e=>l("/api/transactions",{method:"POST",body:JSON.stringify(e)}),Q=e=>l(`/api/transactions/${e}`,{method:"DELETE"}),X=()=>l("/api/users/me",{method:"DELETE"}),ee=(e,t)=>l(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),$=document.querySelector("#landing-view"),k=document.querySelector("#auth-view"),A=document.querySelector("#app-view"),v=document.querySelector("#transactions-table tbody"),te=document.querySelector("#total-receitas"),oe=document.querySelector("#total-despesas"),ne=document.querySelector("#saldo-total"),x=document.querySelector("#login-error"),j=document.querySelector("#register-error"),P=document.querySelector("#success-modal"),H=document.querySelector("#edit-modal"),re=document.querySelector("#edit-transaction-id"),se=document.querySelector("#edit-description"),ae=document.querySelector("#edit-amount"),ce=document.querySelector("#edit-date"),N=document.querySelector("#delete-confirm-modal"),de=document.querySelector("#delete-confirm-input"),ie=document.querySelector("#final-delete-btn"),h=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),le=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},ue=e=>{if(v.innerHTML="",e.length===0){v.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const s=document.createElement("tr"),d=t.type==="receita",o=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
      </svg>
    `,n=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
      </svg>
    `;s.innerHTML=`
      <td>${t.description}</td>
      <td class="${d?"receita":"despesa"}">${h(parseFloat(t.amount))}</td>
      <td>${le(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}">
          ${o}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${n}
        </button>
      </td>
    `,v.appendChild(s)})},me=e=>{const t=e.map(n=>parseFloat(n.amount)),s=t.filter((n,a)=>e[a].type==="receita").reduce((n,a)=>n+a,0),d=t.filter((n,a)=>e[a].type==="despesa").reduce((n,a)=>n+a,0),o=s-d;te.textContent=h(s),oe.textContent=h(d),ne.textContent=h(o)},b=e=>{$.classList.add("hidden"),k.classList.add("hidden"),A.classList.add("hidden"),e==="landing"?$.classList.remove("hidden"):e==="auth"?k.classList.remove("hidden"):e==="app"&&A.classList.remove("hidden")},S=(e,t)=>{const s=e==="login"?x:j;s.textContent=t},I=()=>{x.textContent="",j.textContent=""},pe=()=>{P.classList.remove("hidden")},M=()=>{P.classList.add("hidden")},he=e=>{re.value=e.id.toString(),se.value=e.description,ae.value=parseFloat(e.amount).toFixed(2),ce.value=e.date.split("T")[0],document.querySelector(`input[name="type"][value="${e.type}"]`).checked=!0,H.classList.remove("hidden")},O=()=>{H.classList.add("hidden")},ye=()=>{N.classList.remove("hidden")},C=()=>{de.value="",ie.disabled=!0,N.classList.add("hidden")},fe={"#/auth":()=>b("auth"),"#/dashboard":()=>ge()},p=()=>{const e=window.location.hash||"#/";if(F()&&e==="#/auth"){window.location.hash="#/dashboard";return}const t=fe[e];t?t():b("landing")},ge=async()=>{if(!F()){window.location.hash="#/auth";return}b("app");try{const e=await Z();ue(e),me(e)}catch(e){console.error("Sessão inválida ou erro de rede. Deslogando...",e),E(),window.location.hash="#/auth"}},we=()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),s=document.querySelector("#transaction-form"),d=document.querySelector("#logout-btn"),o=document.querySelector("#transactions-table"),n=document.querySelector("#delete-account-btn"),a=document.querySelector("#success-modal"),q=document.querySelector("#close-modal-btn"),R=document.querySelector("#edit-modal"),y=document.querySelector("#edit-transaction-form"),D=document.querySelector("#cancel-edit-btn"),f=document.querySelector("#final-delete-btn"),T=document.querySelector("#cancel-delete-account-btn"),g=document.querySelector("#delete-confirm-input"),U=document.querySelector("#delete-confirm-modal");if(!e||!t||!s||!d||!o||!n||!a||!q||!R||!y||!D||!f||!T||!g||!U){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}e.addEventListener("submit",async i=>{i.preventDefault(),I();const c=Object.fromEntries(new FormData(e).entries());try{const r=await W(c);z(r.token),window.location.hash="#/dashboard"}catch(r){S("login",r.message)}}),t.addEventListener("submit",async i=>{i.preventDefault(),I();const c=Object.fromEntries(new FormData(t).entries()),r=c.password;if(r.length<6||!/\d/.test(r)||!/[!@#$%^&*(),.?":{}|<>]/.test(r)){S("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}try{await Y(c),pe(),t.reset()}catch(u){S("register",u.message)}}),d.addEventListener("click",()=>{E(),window.location.hash="#/"}),n.addEventListener("click",()=>ye()),s.addEventListener("submit",async i=>{i.preventDefault();const c=Object.fromEntries(new FormData(s).entries());try{await G(c),s.reset(),p()}catch(r){alert(`Erro ao criar transação: ${r.message}`)}}),o.addEventListener("click",i=>{const c=i.target,r=c.closest(".edit-btn"),u=c.closest(".delete-btn");if(r){const m=parseInt(r.getAttribute("data-id"),10),w=r.getAttribute("data-description"),_=r.getAttribute("data-amount"),V=r.getAttribute("data-type"),J=r.getAttribute("data-date");he({id:m,description:w,amount:_,type:V,date:J})}if(u){const m=parseInt(u.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&Q(m).then(p).catch(w=>{alert(`Erro ao deletar transação: ${w.message}`)})}}),y.addEventListener("submit",async i=>{i.preventDefault();const c=new FormData(y),r=parseInt(c.get("transactionId"),10),u={description:c.get("description"),amount:c.get("amount"),date:c.get("date"),type:c.get("type")};try{await ee(r,u),O(),p()}catch(m){alert(`Erro ao atualizar transação: ${m.message}`)}}),D.addEventListener("click",O),q.addEventListener("click",M),a.addEventListener("click",i=>i.target===a&&M()),T.addEventListener("click",C),f.addEventListener("click",async()=>{try{await X(),C(),alert("Sua conta foi deletada com sucesso."),E(),window.location.hash="#/"}catch(i){alert(`Erro ao deletar conta: ${i.message}`)}}),g.addEventListener("input",()=>{f.disabled=g.value!=="CONFIRMAR"})};window.addEventListener("load",p);window.addEventListener("hashchange",p);document.addEventListener("DOMContentLoaded",we);
