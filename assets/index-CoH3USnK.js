(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const w="verdin_auth_token",X=e=>{localStorage.setItem(w,e)},F=()=>localStorage.getItem(w),S=()=>{localStorage.removeItem(w)},ee=()=>!!F(),te="https://verdin-api.onrender.com",u=async(e,t={})=>{const a=F(),d={"Content-Type":"application/json"};a&&(d.Authorization=`Bearer ${a}`);const o=await fetch(`${te}${e}`,{...t,headers:{...d,...t.headers}});if(!o.ok){const n=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(n.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},oe=e=>u("/api/users/login",{method:"POST",body:JSON.stringify(e)}),ne=e=>u("/api/users/register",{method:"POST",body:JSON.stringify(e)}),re=()=>u("/api/transactions"),se=e=>u("/api/transactions",{method:"POST",body:JSON.stringify(e)}),ae=e=>u(`/api/transactions/${e}`,{method:"DELETE"}),ce=()=>u("/api/users/me",{method:"DELETE"}),de=(e,t)=>u(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),C=document.querySelector("#auth-view"),$=document.querySelector("#app-view"),v=document.querySelector("#transactions-table tbody"),ie=document.querySelector("#total-receitas"),le=document.querySelector("#total-despesas"),ue=document.querySelector("#saldo-total"),B=document.querySelector("#login-error"),x=document.querySelector("#register-error"),N=document.querySelector("#success-modal"),j=document.querySelector("#edit-modal"),me=document.querySelector("#edit-transaction-id"),pe=document.querySelector("#edit-description"),ye=document.querySelector("#edit-amount"),ge=document.querySelector("#edit-date"),P=document.querySelector("#delete-confirm-modal"),fe=document.querySelector("#delete-confirm-input"),he=document.querySelector("#final-delete-btn"),g=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Se=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},ve=e=>{if(v.innerHTML="",e.length===0){v.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const a=document.createElement("tr"),d=t.type==="receita",o=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
      </svg>
    `,n=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
      </svg>
    `;a.innerHTML=`
      <td>${t.description}</td>
      <td class="${d?"receita":"despesa"}">${g(parseFloat(t.amount))}</td>
      <td>${Se(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}">
          ${o}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${n}
        </button>
      </td>
    `,v.appendChild(a)})},Ee=e=>{const t=e.map(n=>parseFloat(n.amount)),a=t.filter((n,c)=>e[c].type==="receita").reduce((n,c)=>n+c,0),d=t.filter((n,c)=>e[c].type==="despesa").reduce((n,c)=>n+c,0),o=a-d;ie.textContent=g(a),le.textContent=g(d),ue.textContent=g(o)},I=e=>{e==="app"?(C.classList.add("hidden"),$.classList.remove("hidden")):(C.classList.remove("hidden"),$.classList.add("hidden"))},E=(e,t)=>{const a=e==="login"?B:x;a.textContent=t},M=()=>{B.textContent="",x.textContent=""},Le=()=>{N.classList.remove("hidden")},O=()=>{N.classList.add("hidden")},be=e=>{me.value=e.id.toString(),pe.value=e.description,ye.value=parseFloat(e.amount).toFixed(2),ge.value=e.date.split("T")[0],document.querySelector(`input[name="type"][value="${e.type}"]`).checked=!0,j.classList.remove("hidden")},L=()=>{j.classList.add("hidden")},we=()=>{P.classList.remove("hidden")},b=()=>{fe.value="",he.disabled=!0,P.classList.add("hidden")};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),a=document.querySelector("#transaction-form"),d=document.querySelector("#edit-transaction-form"),o=document.querySelector("#logout-btn"),n=document.querySelector("#delete-account-btn"),c=document.querySelector("#final-delete-btn"),R=document.querySelector("#cancel-delete-account-btn"),q=document.querySelector("#close-modal-btn"),D=document.querySelector("#cancel-edit-btn"),T=document.querySelector("#transactions-table"),f=document.querySelector("#success-modal"),h=document.querySelector("#edit-modal"),k=document.querySelector("#delete-confirm-modal"),A=document.querySelector("#delete-confirm-input");if(!e||!t||!a||!o||!T||!n||!f||!q||!h||!d||!D){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}const H=async r=>{r.preventDefault(),M();const i=Object.fromEntries(new FormData(e).entries());try{const s=await oe(i);X(s.token),await l()}catch(s){E("login",s.message)}},U=async r=>{r.preventDefault(),M();const i=Object.fromEntries(new FormData(t).entries()),s=i.password;if(s.length<6||!/\d/.test(s)||!/[!@#$%^&*(),.?":{}|<>]/.test(s)){E("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}try{await ne(i),Le(),t.reset()}catch(m){E("register",m.message)}},_=()=>{S(),l()},z=async r=>{r.preventDefault();const i=Object.fromEntries(new FormData(a).entries());try{await se(i),a.reset(),await l()}catch(s){alert(`Erro ao criar transação: ${s.message}`)}},J=r=>{const i=r.target,s=i.closest(".edit-btn"),m=i.closest(".delete-btn");if(s){const p=parseInt(s.getAttribute("data-id"),10),y=s.getAttribute("data-description"),Z=s.getAttribute("data-amount"),G=s.getAttribute("data-type"),Q=s.getAttribute("data-date");be({id:p,description:y,amount:Z,type:G,date:Q});return}if(m){const p=parseInt(m.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&ae(p).then(l).catch(y=>{alert(`Erro ao deletar transação: ${y.message}`)});return}},V=async r=>{r.preventDefault();const i=r.target,s=new FormData(i),m=parseInt(s.get("transactionId"),10),p={description:s.get("description"),amount:s.get("amount"),date:s.get("date"),type:s.get("type")};try{await de(m,p),L(),await l()}catch(y){alert(`Erro ao atualizar transação: ${y.message}`)}},K=async()=>{try{await ce(),b(),alert("Sua conta foi deletada com sucesso."),S(),l()}catch(r){alert(`Erro ao deletar conta: ${r.message}`)}},W=()=>{c.disabled=A.value!=="CONFIRMAR"},Y=()=>{we()},l=async()=>{if(ee()){I("app");try{const r=await re();ve(r),Ee(r)}catch(r){console.error("Sessão inválida ou erro de rede. Deslogando...",r),S(),l()}}else I("auth")};e.addEventListener("submit",H),t.addEventListener("submit",U),o.addEventListener("click",_),a.addEventListener("submit",z),T.addEventListener("click",J),q.addEventListener("click",O),f.addEventListener("click",r=>{r.target===f&&O()}),n.addEventListener("click",Y),d.addEventListener("submit",V),D.addEventListener("click",L),h.addEventListener("click",r=>r.target===h&&L()),c.addEventListener("click",K),R.addEventListener("click",b),A.addEventListener("input",W),k.addEventListener("click",r=>r.target===k&&b()),l()});
