(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const h="verdin_auth_token",x=e=>{localStorage.setItem(h,e)},v=()=>localStorage.getItem(h),y=()=>{localStorage.removeItem(h)},I=()=>!!v(),P="https://verdin-api.onrender.com",m=async(e,t={})=>{const s=v(),a={"Content-Type":"application/json"};s&&(a.Authorization=`Bearer ${s}`);const r=await fetch(`${P}${e}`,{...t,headers:{...a,...t.headers}});if(!r.ok){const o=await r.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(o.message||"Ocorreu um erro na requisição.")}return r.status===204||r.headers.get("content-length")==="0"?{success:!0}:r.json()},B=e=>m("/api/users/login",{method:"POST",body:JSON.stringify(e)}),R=e=>m("/api/users/register",{method:"POST",body:JSON.stringify(e)}),j=()=>m("/api/transactions"),_=e=>m("/api/transactions",{method:"POST",body:JSON.stringify(e)}),U=e=>m(`/api/transactions/${e}`,{method:"DELETE"}),S=document.querySelector("#auth-view"),E=document.querySelector("#app-view"),f=document.querySelector("#transactions-table tbody"),V=document.querySelector("#total-receitas"),z=document.querySelector("#total-despesas"),H=document.querySelector("#saldo-total"),T=document.querySelector("#login-error"),D=document.querySelector("#register-error"),q=document.querySelector("#success-modal"),g=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),J=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},K=e=>{if(f.innerHTML="",e.length===0){f.innerHTML='<tr><td colspan="4">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const s=document.createElement("tr"),a=t.type==="receita";s.innerHTML=`
      <td>${t.description}</td>
      <td class="${a?"receita":"despesa"}">${g(parseFloat(t.amount))}</td>
      <td>${J(t.date)}</td>
      <td>
        <button class="delete-btn" data-id="${t.id}">Excluir</button>
      </td>
    `,f.appendChild(s)})},W=e=>{const t=e.map(o=>parseFloat(o.amount)),s=t.filter((o,c)=>e[c].type==="receita").reduce((o,c)=>o+c,0),a=t.filter((o,c)=>e[c].type==="despesa").reduce((o,c)=>o+c,0),r=s-a;V.textContent=g(s),z.textContent=g(a),H.textContent=g(r)},L=e=>{e==="app"?(S.classList.add("hidden"),E.classList.remove("hidden")):(S.classList.remove("hidden"),E.classList.add("hidden"))},p=(e,t)=>{const s=e==="login"?T:D;s.textContent=t},b=()=>{T.textContent="",D.textContent=""},Y=()=>{q.classList.remove("hidden")},w=()=>{q.classList.add("hidden")};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),s=document.querySelector("#transaction-form"),a=document.querySelector("#logout-btn"),r=document.querySelector("#transactions-table"),o=document.querySelector("#success-modal"),c=document.querySelector("#close-modal-btn");if(!e||!t||!s||!a||!r){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM. Verifique os IDs no seu index.html.");return}const O=async n=>{n.preventDefault(),b();const i=new FormData(e),d=Object.fromEntries(i.entries());try{const l=await B(d);x(l.token),await u()}catch(l){p("login",l.message)}},C=async n=>{n.preventDefault(),b();const i=new FormData(t),d=Object.fromEntries(i.entries()),l=d.password,A=/\d/.test(l),F=/[!@#$%^&*(),.?":{}|<>]/.test(l);if(l.length<6||!A||!F){p("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}if(typeof d.password!="string"||d.password.length<6){p("register","A senha deve ser informada e ter no mínimo 6 caracteres.");return}try{await R(d),Y(),t.reset()}catch(N){p("register",N.message)}},$=()=>{y(),u()},M=async n=>{n.preventDefault();const i=new FormData(s),d={description:i.get("description"),amount:i.get("amount"),date:i.get("date"),type:i.get("type")};try{await _(d),s.reset(),await u()}catch(l){alert(`Erro ao criar transação: ${l.message}`)}},k=async n=>{const i=n.target;if(i.classList.contains("delete-btn")){const d=i.getAttribute("data-id");if(d&&confirm("Tem certeza que deseja deletar esta transação?"))try{await U(parseInt(d,10)),await u()}catch(l){alert(`Erro ao deletar transação: ${l.message}`)}}},u=async()=>{if(I()){L("app");try{const n=await j();K(n),W(n)}catch(n){console.error("Sessão inválida ou erro de rede. Deslogando...",n),y(),u()}}else L("auth")};e.addEventListener("submit",O),t.addEventListener("submit",C),a.addEventListener("click",$),s.addEventListener("submit",M),r.addEventListener("click",k),c.addEventListener("click",w),o.addEventListener("click",n=>{n.target===o&&w()}),u()});
