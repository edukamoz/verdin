(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const D="verdin_auth_token",W=e=>{localStorage.setItem(D,e)},P=()=>localStorage.getItem(D),q=()=>{localStorage.removeItem(D)},j=()=>!!P(),Y="https://verdin-api.onrender.com",p=async(e,t={})=>{const r=P(),a={"Content-Type":"application/json"};r&&(a.Authorization=`Bearer ${r}`);const o=await fetch(`${Y}${e}`,{...t,headers:{...a,...t.headers}});if(!o.ok){const n=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(n.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},Z=e=>p("/api/users/login",{method:"POST",body:JSON.stringify(e)}),G=e=>p("/api/users/register",{method:"POST",body:JSON.stringify(e)}),Q=()=>p("/api/transactions"),X=e=>p("/api/transactions",{method:"POST",body:JSON.stringify(e)}),ee=e=>p(`/api/transactions/${e}`,{method:"DELETE"}),te=()=>p("/api/users/me",{method:"DELETE"}),oe=(e,t)=>p(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),I=document.querySelector("#landing-view"),M=document.querySelector("#auth-view"),O=document.querySelector("#app-view"),E=document.querySelector("#transactions-table tbody"),ne=document.querySelector("#total-receitas"),re=document.querySelector("#total-despesas"),se=document.querySelector("#saldo-total"),H=document.querySelector("#login-error"),N=document.querySelector("#register-error"),R=document.querySelector("#success-modal"),U=document.querySelector("#edit-modal"),ce=document.querySelector("#edit-transaction-id"),ae=document.querySelector("#edit-description"),de=document.querySelector("#edit-amount"),ie=document.querySelector("#edit-date"),_=document.querySelector("#delete-confirm-modal"),le=document.querySelector("#delete-confirm-input"),ue=document.querySelector("#final-delete-btn"),S=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),me=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},pe=e=>{if(E.innerHTML="",e.length===0){E.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const r=document.createElement("tr"),a=t.type==="receita",o=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
      </svg>
    `,n=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
      </svg>
    `;r.innerHTML=`
      <td>${t.description}</td>
      <td class="${a?"receita":"despesa"}">${S(parseFloat(t.amount))}</td>
      <td>${me(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}">
          ${o}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${n}
        </button>
      </td>
    `,E.appendChild(r)})},he=e=>{const t=e.map(n=>parseFloat(n.amount)),r=t.filter((n,c)=>e[c].type==="receita").reduce((n,c)=>n+c,0),a=t.filter((n,c)=>e[c].type==="despesa").reduce((n,c)=>n+c,0),o=r-a;ne.textContent=S(r),re.textContent=S(a),se.textContent=S(o)},T=e=>{I.classList.add("hidden"),M.classList.add("hidden"),O.classList.add("hidden"),e==="landing"?I.classList.remove("hidden"):e==="auth"?M.classList.remove("hidden"):e==="app"&&O.classList.remove("hidden")},b=(e,t)=>{const r=e==="login"?H:N;r.textContent=t},C=()=>{H.textContent="",N.textContent=""},ye=()=>{R.classList.remove("hidden")},B=()=>{R.classList.add("hidden")},ge=e=>{ce.value=e.id.toString(),ae.value=e.description,de.value=parseFloat(e.amount).toFixed(2),ie.value=e.date.split("T")[0];const t=document.querySelector("#edit-type-switch");t.checked=e.type==="despesa",document.querySelector(".edit-receita-label").classList.toggle("active",e.type==="receita"),document.querySelector(".edit-despesa-label").classList.toggle("active",e.type==="despesa"),U.classList.remove("hidden")},F=()=>{U.classList.add("hidden")},fe=()=>{_.classList.remove("hidden")},x=()=>{le.value="",ue.disabled=!0,_.classList.add("hidden")},Se={"#/auth":()=>T("auth"),"#/dashboard":()=>we()},y=()=>{const e=window.location.hash||"#/";if(j()&&e==="#/auth"){window.location.hash="#/dashboard";return}const t=Se[e];t?t():T("landing")},we=async()=>{if(!j()){window.location.hash="#/auth";return}T("app");try{const e=await Q();pe(e),he(e)}catch(e){console.error("Sessão inválida ou erro de rede. Deslogando...",e),q(),window.location.hash="#/auth"}},ve=()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),r=document.querySelector("#transaction-form"),a=document.querySelector("#logout-btn"),o=document.querySelector("#transactions-table"),n=document.querySelector("#delete-account-btn"),c=document.querySelector("#success-modal"),k=document.querySelector("#close-modal-btn"),V=document.querySelector("#edit-modal"),u=document.querySelector("#edit-transaction-form"),$=document.querySelector("#cancel-edit-btn"),w=document.querySelector("#final-delete-btn"),A=document.querySelector("#cancel-delete-account-btn"),v=document.querySelector("#delete-confirm-input"),J=document.querySelector("#delete-confirm-modal"),g=r?.querySelector("#type-switch"),f=u?.querySelector("#edit-type-switch");if(g&&g.addEventListener("change",()=>{r?.querySelector(".receita-label").classList.toggle("active",!g.checked),r?.querySelector(".despesa-label").classList.toggle("active",g.checked)}),f&&f.addEventListener("change",()=>{u?.querySelector(".edit-receita-label").classList.toggle("active",!f.checked),u?.querySelector(".edit-despesa-label").classList.toggle("active",f.checked)}),!e||!t||!r||!a||!o||!n||!c||!k||!V||!u||!$||!w||!A||!v||!J){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}e.addEventListener("submit",async d=>{d.preventDefault(),C();const i=Object.fromEntries(new FormData(e).entries());try{const s=await Z(i);W(s.token),window.location.hash="#/dashboard"}catch(s){b("login",s.message)}}),t.addEventListener("submit",async d=>{d.preventDefault(),C();const i=Object.fromEntries(new FormData(t).entries()),s=i.password;if(s.length<6||!/\d/.test(s)||!/[!@#$%^&*(),.?":{}|<>]/.test(s)){b("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}try{await G(i),ye(),t.reset()}catch(l){b("register",l.message)}}),a.addEventListener("click",()=>{q(),window.location.hash="#/"}),n.addEventListener("click",()=>fe()),r.addEventListener("submit",async d=>{d.preventDefault();const i=new FormData(r),s=r.querySelector("#type-switch"),l={description:i.get("description"),amount:i.get("amount"),date:i.get("date"),type:s.checked?"despesa":"receita"};try{await X(l),r.reset(),y()}catch(m){alert(`Erro ao criar transação: ${m.message}`)}}),o.addEventListener("click",d=>{const i=d.target,s=i.closest(".edit-btn"),l=i.closest(".delete-btn");if(s){const m=parseInt(s.getAttribute("data-id"),10),h=s.getAttribute("data-description"),L=s.getAttribute("data-amount"),z=s.getAttribute("data-type"),K=s.getAttribute("data-date");ge({id:m,description:h,amount:L,type:z,date:K})}if(l){const m=parseInt(l.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&ee(m).then(y).catch(h=>{alert(`Erro ao deletar transação: ${h.message}`)})}}),u.addEventListener("submit",async d=>{d.preventDefault();const i=new FormData(u),s=parseInt(i.get("transactionId"),10),l=new FormData(u),m=u.querySelector("#edit-type-switch"),h={description:l.get("description"),amount:l.get("amount"),date:l.get("date"),type:m.checked?"despesa":"receita"};try{await oe(s,h),F(),y()}catch(L){alert(`Erro ao atualizar transação: ${L.message}`)}}),$.addEventListener("click",F),k.addEventListener("click",B),c.addEventListener("click",d=>d.target===c&&B()),A.addEventListener("click",x),w.addEventListener("click",async()=>{try{await te(),x(),alert("Sua conta foi deletada com sucesso."),q(),window.location.hash="#/"}catch(d){alert(`Erro ao deletar conta: ${d.message}`)}}),v.addEventListener("input",()=>{w.disabled=v.value!=="CONFIRMAR"})};window.addEventListener("load",y);window.addEventListener("hashchange",y);document.addEventListener("DOMContentLoaded",ve);
