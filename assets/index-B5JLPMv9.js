(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const y="verdin_auth_token",F=e=>{localStorage.setItem(y,e)},w=()=>localStorage.getItem(y),g=()=>{localStorage.removeItem(y)},x=()=>!!w(),B="https://verdin-api.onrender.com",m=async(e,t={})=>{const n=w(),a={"Content-Type":"application/json"};n&&(a.Authorization=`Bearer ${n}`);const o=await fetch(`${B}${e}`,{...t,headers:{...a,...t.headers}});if(!o.ok){const r=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(r.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},j=e=>m("/api/users/login",{method:"POST",body:JSON.stringify(e)}),_=e=>m("/api/users/register",{method:"POST",body:JSON.stringify(e)}),H=()=>m("/api/transactions"),U=e=>m("/api/transactions",{method:"POST",body:JSON.stringify(e)}),V=e=>m(`/api/transactions/${e}`,{method:"DELETE"}),z=()=>m("/api/users/me",{method:"DELETE"}),E=document.querySelector("#auth-view"),S=document.querySelector("#app-view"),h=document.querySelector("#transactions-table tbody"),J=document.querySelector("#total-receitas"),K=document.querySelector("#total-despesas"),W=document.querySelector("#saldo-total"),v=document.querySelector("#login-error"),D=document.querySelector("#register-error"),q=document.querySelector("#success-modal"),f=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Y=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},G=e=>{if(h.innerHTML="",e.length===0){h.innerHTML='<tr><td colspan="4">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const n=document.createElement("tr"),a=t.type==="receita";n.innerHTML=`
      <td>${t.description}</td>
      <td class="${a?"receita":"despesa"}">${f(parseFloat(t.amount))}</td>
      <td>${Y(t.date)}</td>
      <td>
        <button class="delete-btn" data-id="${t.id}">Excluir</button>
      </td>
    `,h.appendChild(n)})},Q=e=>{const t=e.map(r=>parseFloat(r.amount)),n=t.filter((r,c)=>e[c].type==="receita").reduce((r,c)=>r+c,0),a=t.filter((r,c)=>e[c].type==="despesa").reduce((r,c)=>r+c,0),o=n-a;J.textContent=f(n),K.textContent=f(a),W.textContent=f(o)},L=e=>{e==="app"?(E.classList.add("hidden"),S.classList.remove("hidden")):(E.classList.remove("hidden"),S.classList.add("hidden"))},p=(e,t)=>{const n=e==="login"?v:D;n.textContent=t},T=()=>{v.textContent="",D.textContent=""},X=()=>{q.classList.remove("hidden")},b=()=>{q.classList.add("hidden")};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),n=document.querySelector("#transaction-form"),a=document.querySelector("#logout-btn"),o=document.querySelector("#transactions-table"),r=document.querySelector("#success-modal"),c=document.querySelector("#close-modal-btn"),A=document.querySelector("#delete-account-btn");if(!e||!t||!n||!a||!o){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM. Verifique os IDs no seu index.html.");return}const O=async s=>{s.preventDefault(),T();const i=new FormData(e),d=Object.fromEntries(i.entries());try{const l=await j(d);F(l.token),await u()}catch(l){p("login",l.message)}},C=async s=>{s.preventDefault(),T();const i=new FormData(t),d=Object.fromEntries(i.entries()),l=d.password,I=/\d/.test(l),P=/[!@#$%^&*(),.?":{}|<>]/.test(l);if(l.length<6||!I||!P){p("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}if(typeof d.password!="string"||d.password.length<6){p("register","A senha deve ser informada e ter no mínimo 6 caracteres.");return}try{await _(d),X(),t.reset()}catch(R){p("register",R.message)}},N=()=>{g(),u()},M=async s=>{s.preventDefault();const i=new FormData(n),d={description:i.get("description"),amount:i.get("amount"),date:i.get("date"),type:i.get("type")};try{await U(d),n.reset(),await u()}catch(l){alert(`Erro ao criar transação: ${l.message}`)}},$=async s=>{const i=s.target;if(i.classList.contains("delete-btn")){const d=i.getAttribute("data-id");if(d&&confirm("Tem certeza que deseja deletar esta transação?"))try{await V(parseInt(d,10)),await u()}catch(l){alert(`Erro ao deletar transação: ${l.message}`)}}},u=async()=>{if(x()){L("app");try{const s=await H();G(s),Q(s)}catch(s){console.error("Sessão inválida ou erro de rede. Deslogando...",s),g(),u()}}else L("auth")},k=async()=>{if(prompt(`Esta ação é PERMANENTE e irá deletar sua conta e todas as suas transações.

Para confirmar, digite "DELETAR MINHA CONTA":`)==="DELETAR MINHA CONTA")try{await z(),alert("Sua conta foi deletada com sucesso."),g(),u()}catch(i){alert(`Erro ao deletar a conta: ${i.message}`)}else alert("Ação cancelada.")};e.addEventListener("submit",O),t.addEventListener("submit",C),a.addEventListener("click",N),n.addEventListener("submit",M),o.addEventListener("click",$),c.addEventListener("click",b),r.addEventListener("click",s=>{s.target===r&&b()}),A.addEventListener("click",k),u()});
