(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function c(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(a){if(a.ep)return;a.ep=!0;const s=c(a);fetch(a.href,s)}})();const V="verdin_auth_token",he=e=>{localStorage.setItem(V,e)},ee=()=>localStorage.getItem(V),O=()=>{localStorage.removeItem(V)},F=()=>!!ee(),fe="https://verdin-api.onrender.com",f=async(e,t={})=>{const c=ee(),l={"Content-Type":"application/json"};c&&(l.Authorization=`Bearer ${c}`);const a=await fetch(`${fe}${e}`,{...t,headers:{...l,...t.headers}});if(!a.ok){const s=await a.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(s.message||"Ocorreu um erro na requisição.")}return a.status===204||a.headers.get("content-length")==="0"?{success:!0}:a.json()},ve=e=>f("/api/users/login",{method:"POST",body:JSON.stringify(e)}),Se=e=>f("/api/users/register",{method:"POST",body:JSON.stringify(e)}),te=(e={})=>{const t=new URLSearchParams(e).toString();return f(`/api/transactions?${t}`)},Le=e=>f("/api/transactions",{method:"POST",body:JSON.stringify(e)}),we=e=>f(`/api/transactions/${e}`,{method:"DELETE"}),qe=()=>f("/api/users/me",{method:"DELETE"}),Ee=(e,t)=>f(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),_=document.querySelector("#landing-view"),z=document.querySelector("#open-add-modal-btn"),oe=document.querySelector("#filter-modal"),be=()=>oe.classList.remove("hidden"),x=()=>oe.classList.add("hidden"),J=document.querySelector("#auth-view"),K=document.querySelector("#app-view"),w=document.querySelector("#header-cta-btn"),$=document.querySelector("#transactions-table tbody"),ke=document.querySelector("#total-receitas"),Ce=document.querySelector("#total-despesas"),Me=document.querySelector("#saldo-total"),E=document.querySelector("#login-error"),ne=document.querySelector("#success-modal"),re=document.querySelector("#edit-modal"),Te=document.querySelector("#edit-transaction-id"),De=document.querySelector("#edit-description"),Ae=document.querySelector("#edit-amount"),xe=document.querySelector("#edit-date"),ae=document.querySelector("#delete-confirm-modal"),$e=document.querySelector("#delete-confirm-input"),Ie=document.querySelector("#final-delete-btn"),se=document.querySelector("#add-transaction-modal"),q=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Be=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},Oe=["Moradia","Transporte","Alimentação","Lazer","Estudos","Viagens","Outras"],Z=document.querySelector("#category-filter-select"),Fe=()=>{Z.innerHTML="",Oe.forEach(e=>{const t=document.createElement("div");t.classList.add("category-checkbox"),t.innerHTML=`
      <input type="checkbox" id="cat-${e}" name="category" value="${e}">
      <label for="cat-${e}">${e}</label>
    `,Z.appendChild(t)})},ce=e=>{if($.innerHTML="",e.length===0){$.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const c=document.createElement("tr"),l=t.type==="receita",a=t.type==="despesa"?t.category||"Outras":"---",s='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>',d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>';c.innerHTML=`
      <td>${a}</td>
      <td>${t.description}</td>
      <td class="${l?"receita":"despesa"}">${q(parseFloat(t.amount))}</td>
      <td>${Be(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}"
          data-category="${t.category||""}">
          ${s}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${d}
        </button>
      </td>
    `,$.appendChild(c)})},de=e=>{const t=e.map(s=>parseFloat(s.amount)),c=t.filter((s,d)=>e[d].type==="receita").reduce((s,d)=>s+d,0),l=t.filter((s,d)=>e[d].type==="despesa").reduce((s,d)=>s+d,0),a=c-l;ke.textContent=q(c),Ce.textContent=q(l),Me.textContent=q(a)},H=e=>{_.classList.add("hidden"),J.classList.add("hidden"),K.classList.add("hidden"),z.classList.add("hidden"),e==="landing"?_.classList.remove("hidden"):e==="auth"?J.classList.remove("hidden"):e==="app"&&(K.classList.remove("hidden"),z.classList.remove("hidden"))},Ve=e=>{E&&(E.textContent=e)},He=()=>{E&&(E.textContent=""),document.querySelectorAll("#register-form .error-message-inline").forEach(e=>{e.textContent=""})},Pe=()=>{ne.classList.remove("hidden")},W=()=>{ne.classList.add("hidden")},je=e=>{Te.value=e.id.toString(),De.value=e.description,Ae.value=parseFloat(e.amount).toFixed(2),xe.value=e.date.split("T")[0];const t=document.querySelector("#edit-type-switch");t.checked=e.type==="despesa";const c=document.querySelector("#edit-category-container"),l=document.querySelector("#edit-category");document.querySelector(".edit-receita-label").classList.toggle("active",e.type==="receita"),document.querySelector(".edit-despesa-label").classList.toggle("active",e.type==="despesa"),e.type==="despesa"?(c.classList.remove("hidden"),l.value=e.category||"Outras"):c.classList.add("hidden"),re.classList.remove("hidden")},Y=()=>{re.classList.add("hidden")},Re=()=>{ae.classList.remove("hidden")},G=()=>{$e.value="",Ie.disabled=!0,ae.classList.add("hidden")},Ne=e=>{w&&(e?(w.textContent="Meu Dashboard",w.href="#/dashboard"):(w.textContent="Acessar Plataforma",w.href="#/auth"))},Ue=()=>{se.classList.remove("hidden")},I=()=>{se.classList.add("hidden")},Q='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>',_e='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243L6.228 6.228" /></svg>',ze=document.querySelector("#open-filter-modal-btn"),X=document.querySelector("#filter-modal"),Je=document.querySelector("#clear-filters-btn"),B=document.querySelector("#filter-form"),Ke={"#/auth":()=>H("auth"),"#/dashboard":()=>Ze()},v=()=>{Ne(F());const e=window.location.hash||"#/";if(F()&&e==="#/auth"){window.location.hash="#/dashboard";return}const t=Ke[e];t?t():H("landing")},Ze=async()=>{if(!F()){window.location.hash="#/auth";return}H("app");try{const e=await te();ce(e),de(e)}catch(e){console.error("Sessão inválida ou erro de rede. Deslogando...",e),O(),window.location.hash="#/auth"}},We=()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),c=document.querySelector("#transaction-form"),l=document.querySelector("#logout-btn"),a=document.querySelector("#transactions-table"),s=document.querySelector("#delete-account-btn"),d=document.querySelector("#success-modal"),P=document.querySelector("#close-modal-btn"),ie=document.querySelector("#edit-modal"),h=document.querySelector("#edit-transaction-form"),j=document.querySelector("#cancel-edit-btn"),b=document.querySelector("#final-delete-btn"),R=document.querySelector("#cancel-delete-account-btn"),k=document.querySelector("#delete-confirm-input"),le=document.querySelector("#delete-confirm-modal"),S=c.querySelector("#type-switch"),L=h.querySelector("#edit-type-switch"),ue=document.querySelector("#open-add-modal-btn"),me=document.querySelector("#cancel-add-btn"),N=document.querySelector("#add-transaction-modal"),C=document.querySelector("#min-value-input"),M=document.querySelector("#min-value-range"),T=document.querySelector("#max-value-input"),D=document.querySelector("#max-value-range");if(C.addEventListener("input",()=>M.value=C.value),M.addEventListener("input",()=>C.value=M.value),T.addEventListener("input",()=>D.value=T.value),D.addEventListener("input",()=>T.value=D.value),S&&S.addEventListener("change",()=>{const r=c?.querySelector("#category-container");c?.querySelector(".receita-label")?.classList.toggle("active",!S.checked),c?.querySelector(".despesa-label")?.classList.toggle("active",S.checked),r?.classList.toggle("hidden",!S.checked)}),L&&L.addEventListener("change",()=>{const r=h.querySelector("#edit-category-container");h.querySelector(".edit-receita-label")?.classList.toggle("active",!L.checked),h.querySelector(".edit-despesa-label")?.classList.toggle("active",L.checked),r?.classList.toggle("hidden",!L.checked)}),!e||!t||!c||!l||!a||!s||!d||!P||!ie||!h||!j||!b||!R||!k||!le){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}ue.addEventListener("click",Ue),me.addEventListener("click",I),N.addEventListener("click",r=>{r.target===N&&I()});const pe=()=>{document.querySelectorAll(".password-toggle-icon").forEach(r=>{r.innerHTML=Q,r.addEventListener("click",()=>{const o=r.dataset.target;if(!o)return;const n=document.querySelector(`#${o}`);if(!n)return;const u=n.type==="password";n.type=u?"text":"password",r.innerHTML=u?_e:Q})})};e.addEventListener("submit",async r=>{r.preventDefault(),He();const o=Object.fromEntries(new FormData(e).entries());try{const n=await ve(o);he(n.token),window.location.hash="#/dashboard"}catch(n){Ve(n.message)}});const ye=async r=>{r.preventDefault();let o=!0;document.querySelectorAll(".error-message-inline").forEach(y=>y.textContent="");const n=document.querySelector("#register-name"),u=document.querySelector("#register-email"),i=document.querySelector("#register-password"),m=document.querySelector("#register-password-confirm");n.value.trim()===""&&(document.querySelector("#name-error").textContent="O nome é obrigatório.",o=!1),u.value.trim()===""?(document.querySelector("#email-error").textContent="O e-mail é obrigatório.",o=!1):/\S+@\S+\.\S+/.test(u.value)||(document.querySelector("#email-error").textContent="Formato de e-mail inválido.",o=!1);const g=i.value,p=[];if(g.length<8&&p.push("8 caracteres"),/\d/.test(g)||p.push("um número"),/[!@#$%^&*(),.?":{}|<>]/.test(g)||p.push("um caractere especial"),p.length>0&&(document.querySelector("#password-error").textContent=`A senha precisa ter no mínimo: ${p.join(", ")}.`,o=!1),m.value!==g&&(document.querySelector("#password-confirm-error").textContent="As senhas não coincidem.",o=!1),!!o)try{const y={name:n.value,email:u.value,password:i.value};await Se(y),Pe(),t.reset()}catch(y){document.querySelector("#email-error").textContent=y.message}};t.addEventListener("submit",ye),pe(),l.addEventListener("click",()=>{O(),window.location.hash="#/"}),s.addEventListener("click",()=>Re()),c.addEventListener("submit",async r=>{r.preventDefault();const o=new FormData(c),n=c.querySelector("#type-switch"),u={description:o.get("description"),amount:o.get("amount"),date:o.get("date"),type:n.checked?"despesa":"receita",category:n.checked?o.get("category"):null};try{await Le(u),c.reset(),I(),v()}catch(i){alert(`Erro ao criar transação: ${i.message}`)}}),a.addEventListener("click",r=>{const o=r.target,n=o.closest(".edit-btn"),u=o.closest(".delete-btn");if(n){const i=parseInt(n.getAttribute("data-id"),10),m=n.getAttribute("data-description"),g=n.getAttribute("data-amount"),p=n.getAttribute("data-type"),y=n.getAttribute("data-date");je({id:i,description:m,amount:g,type:p,date:y})}if(u){const i=parseInt(u.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&we(i).then(v).catch(m=>{alert(`Erro ao deletar transação: ${m.message}`)})}}),h.addEventListener("submit",async r=>{r.preventDefault();const o=new FormData(h),n=parseInt(o.get("transactionId"),10),u=h.querySelector("#edit-type-switch"),i={description:o.get("description"),amount:o.get("amount"),date:o.get("date"),type:u.checked?"despesa":"receita",category:u.checked?o.get("category"):null};try{await Ee(n,i),Y(),v()}catch(m){alert(`Erro ao atualizar transação: ${m.message}`)}}),j.addEventListener("click",Y),P.addEventListener("click",W),d.addEventListener("click",r=>r.target===d&&W()),ze.addEventListener("click",be),Je.addEventListener("click",()=>{B.reset(),v(),x()}),X.addEventListener("click",r=>{r.target===X&&x()}),B.addEventListener("submit",async r=>{r.preventDefault();const o=new FormData(B),n={},i=document.querySelector(".segmented-control button.active")?.getAttribute("data-value");i&&i!=="todos"&&(n.type=i);const m=Array.from(o.getAll("category")).join(",");m&&(n.category=m),i&&i!=="todos"&&(n.type=i),m&&(n.category=m),o.get("startDate")&&(n.startDate=o.get("startDate")),o.get("endDate")&&(n.endDate=o.get("endDate"));const g=o.get("description");g&&(n.description=g);const p=o.get("minValue");p&&(n.minValue=p);const y=o.get("maxValue");y&&(n.maxValue=y);try{const A=await te(n);ce(A),de(A),x()}catch{alert("Erro ao aplicar filtros.")}}),Fe();const U=document.querySelectorAll(".segmented-control button"),ge=document.querySelector("#filter-category-container");U.forEach(r=>{r.addEventListener("click",()=>{U.forEach(n=>n.classList.remove("active")),r.classList.add("active");const o=r.getAttribute("data-value");ge?.classList.toggle("hidden",o!=="despesa")})}),R.addEventListener("click",G),b.addEventListener("click",async()=>{try{await qe(),G(),alert("Sua conta foi deletada com sucesso."),O(),window.location.hash="#/"}catch(r){alert(`Erro ao deletar conta: ${r.message}`)}}),k.addEventListener("input",()=>{b.disabled=k.value!=="CONFIRMAR"})};window.addEventListener("load",v);window.addEventListener("hashchange",v);document.addEventListener("DOMContentLoaded",We);
