(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();const L="verdin_auth_token",J=e=>{localStorage.setItem(L,e)},O=()=>localStorage.getItem(L),f=()=>{localStorage.removeItem(L)},V=()=>!!O(),K="https://verdin-api.onrender.com",u=async(e,t={})=>{const a=O(),i={"Content-Type":"application/json"};a&&(i.Authorization=`Bearer ${a}`);const o=await fetch(`${K}${e}`,{...t,headers:{...i,...t.headers}});if(!o.ok){const r=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(r.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},W=e=>u("/api/users/login",{method:"POST",body:JSON.stringify(e)}),Y=e=>u("/api/users/register",{method:"POST",body:JSON.stringify(e)}),Z=()=>u("/api/transactions"),G=e=>u("/api/transactions",{method:"POST",body:JSON.stringify(e)}),Q=e=>u(`/api/transactions/${e}`,{method:"DELETE"}),X=()=>u("/api/users/me",{method:"DELETE"}),ee=(e,t)=>u(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),q=document.querySelector("#auth-view"),A=document.querySelector("#app-view"),E=document.querySelector("#transactions-table tbody"),te=document.querySelector("#total-receitas"),oe=document.querySelector("#total-despesas"),re=document.querySelector("#saldo-total"),I=document.querySelector("#login-error"),M=document.querySelector("#register-error"),C=document.querySelector("#success-modal"),y=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),ne=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},se=e=>{if(E.innerHTML="",e.length===0){E.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const a=document.createElement("tr"),i=t.type==="receita",o=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
      </svg>
    `,r=`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
      </svg>
    `;a.innerHTML=`
      <td>${t.description}</td>
      <td class="${i?"receita":"despesa"}">${y(parseFloat(t.amount))}</td>
      <td>${ne(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}">
          ${o}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${r} </button>
      </td>
    `,E.appendChild(a)})},ae=e=>{const t=e.map(r=>parseFloat(r.amount)),a=t.filter((r,c)=>e[c].type==="receita").reduce((r,c)=>r+c,0),i=t.filter((r,c)=>e[c].type==="despesa").reduce((r,c)=>r+c,0),o=a-i;te.textContent=y(a),oe.textContent=y(i),re.textContent=y(o)},D=e=>{e==="app"?(q.classList.add("hidden"),A.classList.remove("hidden")):(q.classList.remove("hidden"),A.classList.add("hidden"))},S=(e,t)=>{const a=e==="login"?I:M;a.textContent=t},k=()=>{I.textContent="",M.textContent=""},ce=()=>{C.classList.remove("hidden")},$=()=>{C.classList.add("hidden")},F=document.querySelector("#edit-modal"),ie=document.querySelector("#edit-transaction-id"),de=document.querySelector("#edit-description"),le=document.querySelector("#edit-amount"),ue=document.querySelector("#edit-date"),me=e=>{ie.value=e.id.toString(),de.value=e.description,le.value=parseFloat(e.amount).toFixed(2),ue.value=e.date.split("T")[0],document.querySelector(`input[name="type"][value="${e.type}"]`).checked=!0,F.classList.remove("hidden")},v=()=>{F.classList.add("hidden")};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),a=document.querySelector("#transaction-form"),i=document.querySelector("#logout-btn"),o=document.querySelector("#transactions-table"),r=document.querySelector("#delete-account-btn"),c=document.querySelector("#success-modal"),b=document.querySelector("#close-modal-btn"),h=document.querySelector("#edit-modal"),w=document.querySelector("#edit-transaction-form"),T=document.querySelector("#cancel-edit-btn");if(!e||!t||!a||!i||!o||!r||!c||!b||!h||!w||!T){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}const N=async s=>{s.preventDefault(),k();const d=Object.fromEntries(new FormData(e).entries());try{const n=await W(d);J(n.token),await l()}catch(n){S("login",n.message)}},B=async s=>{s.preventDefault(),k();const d=Object.fromEntries(new FormData(t).entries()),n=d.password;if(n.length<6||!/\d/.test(n)||!/[!@#$%^&*(),.?":{}|<>]/.test(n)){S("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}try{await Y(d),ce(),t.reset()}catch(m){S("register",m.message)}},x=()=>{f(),l()},P=async s=>{s.preventDefault();const d=Object.fromEntries(new FormData(a).entries());try{await G(d),a.reset(),await l()}catch(n){alert(`Erro ao criar transação: ${n.message}`)}},R=s=>{const d=s.target,n=d.closest(".edit-btn"),m=d.closest(".delete-btn");if(n){const p=parseInt(n.getAttribute("data-id"),10),g=n.getAttribute("data-description"),U=n.getAttribute("data-amount"),_=n.getAttribute("data-type"),z=n.getAttribute("data-date");me({id:p,description:g,amount:U,type:_,date:z});return}if(m){const p=parseInt(m.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&Q(p).then(l).catch(g=>{alert(`Erro ao deletar transação: ${g.message}`)});return}},j=async s=>{s.preventDefault();const d=s.target,n=new FormData(d),m=parseInt(n.get("transactionId"),10),p={description:n.get("description"),amount:n.get("amount"),date:n.get("date"),type:n.get("type")};try{await ee(m,p),v(),await l()}catch(g){alert(`Erro ao atualizar transação: ${g.message}`)}},l=async()=>{if(V()){D("app");try{const s=await Z();se(s),ae(s)}catch(s){console.error("Sessão inválida ou erro de rede. Deslogando...",s),f(),l()}}else D("auth")},H=async()=>{if(prompt(`Esta ação é PERMANENTE e irá deletar sua conta e todas as suas transações.

Para confirmar, digite "DELETAR MINHA CONTA":`)==="DELETAR MINHA CONTA")try{await X(),alert("Sua conta foi deletada com sucesso."),f(),l()}catch(d){alert(`Erro ao deletar a conta: ${d.message}`)}else alert("Ação cancelada.")};e.addEventListener("submit",N),t.addEventListener("submit",B),i.addEventListener("click",x),a.addEventListener("submit",P),o.addEventListener("click",R),b.addEventListener("click",$),c.addEventListener("click",s=>{s.target===c&&$()}),r.addEventListener("click",H),w.addEventListener("submit",j),T.addEventListener("click",v),h.addEventListener("click",s=>s.target===h&&v()),l()});
