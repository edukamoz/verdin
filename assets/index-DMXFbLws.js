(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const T="verdin_auth_token",W=e=>{localStorage.setItem(T,e)},P=()=>localStorage.getItem(T),q=()=>{localStorage.removeItem(T)},D=()=>!!P(),Y="https://verdin-api.onrender.com",h=async(e,t={})=>{const n=P(),i={"Content-Type":"application/json"};n&&(i.Authorization=`Bearer ${n}`);const o=await fetch(`${Y}${e}`,{...t,headers:{...i,...t.headers}});if(!o.ok){const r=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(r.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},Z=e=>h("/api/users/login",{method:"POST",body:JSON.stringify(e)}),Q=e=>h("/api/users/register",{method:"POST",body:JSON.stringify(e)}),X=()=>h("/api/transactions"),ee=e=>h("/api/transactions",{method:"POST",body:JSON.stringify(e)}),te=e=>h(`/api/transactions/${e}`,{method:"DELETE"}),oe=()=>h("/api/users/me",{method:"DELETE"}),ne=(e,t)=>h(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),$=document.querySelector("#landing-view"),M=document.querySelector("#auth-view"),I=document.querySelector("#app-view"),f=document.querySelector("#header-cta-btn"),E=document.querySelector("#transactions-table tbody"),re=document.querySelector("#total-receitas"),ce=document.querySelector("#total-despesas"),se=document.querySelector("#saldo-total"),R=document.querySelector("#login-error"),H=document.querySelector("#register-error"),j=document.querySelector("#success-modal"),U=document.querySelector("#edit-modal"),ae=document.querySelector("#edit-transaction-id"),de=document.querySelector("#edit-description"),ie=document.querySelector("#edit-amount"),le=document.querySelector("#edit-date"),V=document.querySelector("#delete-confirm-modal"),ue=document.querySelector("#delete-confirm-input"),me=document.querySelector("#final-delete-btn"),w=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),he=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},ye=e=>{if(E.innerHTML="",e.length===0){E.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const n=document.createElement("tr"),i=t.type==="receita",o=t.type==="despesa"?t.category||"Outras":"---",r='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>',d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>';n.innerHTML=`
      <td>${o}</td>
      <td>${t.description}</td>
      <td class="${i?"receita":"despesa"}">${w(parseFloat(t.amount))}</td>
      <td>${he(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}"
          data-category="${t.category||""}">
          ${r}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${d}
        </button>
      </td>
    `,E.appendChild(n)})},pe=e=>{const t=e.map(r=>parseFloat(r.amount)),n=t.filter((r,d)=>e[d].type==="receita").reduce((r,d)=>r+d,0),i=t.filter((r,d)=>e[d].type==="despesa").reduce((r,d)=>r+d,0),o=n-i;re.textContent=w(n),ce.textContent=w(i),se.textContent=w(o)},k=e=>{$.classList.add("hidden"),M.classList.add("hidden"),I.classList.add("hidden"),e==="landing"?$.classList.remove("hidden"):e==="auth"?M.classList.remove("hidden"):e==="app"&&I.classList.remove("hidden")},b=(e,t)=>{const n=e==="login"?R:H;n.textContent=t},B=()=>{R.textContent="",H.textContent=""},ge=()=>{j.classList.remove("hidden")},F=()=>{j.classList.add("hidden")},fe=e=>{ae.value=e.id.toString(),de.value=e.description,ie.value=parseFloat(e.amount).toFixed(2),le.value=e.date.split("T")[0];const t=document.querySelector("#edit-type-switch");t.checked=e.type==="despesa";const n=document.querySelector("#edit-category-container"),i=document.querySelector("#edit-category");document.querySelector(".edit-receita-label").classList.toggle("active",e.type==="receita"),document.querySelector(".edit-despesa-label").classList.toggle("active",e.type==="despesa"),e.type==="despesa"?(n.classList.remove("hidden"),i.value=e.category||"Outras"):n.classList.add("hidden"),U.classList.remove("hidden")},x=()=>{U.classList.add("hidden")},Se=()=>{V.classList.remove("hidden")},N=()=>{ue.value="",me.disabled=!0,V.classList.add("hidden")},we=e=>{f&&(e?(f.textContent="Meu Dashboard",f.href="#/dashboard"):(f.textContent="Acessar Plataforma",f.href="#/auth"))},ve={"#/auth":()=>k("auth"),"#/dashboard":()=>Le()},S=()=>{we(D());const e=window.location.hash||"#/";if(D()&&e==="#/auth"){window.location.hash="#/dashboard";return}const t=ve[e];t?t():k("landing")},Le=async()=>{if(!D()){window.location.hash="#/auth";return}k("app");try{const e=await X();ye(e),pe(e)}catch(e){console.error("Sessão inválida ou erro de rede. Deslogando...",e),q(),window.location.hash="#/auth"}},Ee=()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),n=document.querySelector("#transaction-form"),i=document.querySelector("#logout-btn"),o=document.querySelector("#transactions-table"),r=document.querySelector("#delete-account-btn"),d=document.querySelector("#success-modal"),C=document.querySelector("#close-modal-btn"),_=document.querySelector("#edit-modal"),u=document.querySelector("#edit-transaction-form"),A=document.querySelector("#cancel-edit-btn"),v=document.querySelector("#final-delete-btn"),O=document.querySelector("#cancel-delete-account-btn"),L=document.querySelector("#delete-confirm-input"),J=document.querySelector("#delete-confirm-modal"),y=n.querySelector("#type-switch"),p=u.querySelector("#edit-type-switch");if(y&&y.addEventListener("change",()=>{console.log("--- DEBUG: Switch de NOVA TRANSAÇÃO foi alterado! ---"),console.log("Está marcado (é despesa)?",y.checked);const s=n?.querySelector("#category-container");console.log("Elemento do container de categoria encontrado:",s),n?.querySelector(".receita-label")?.classList.toggle("active",!y.checked),n?.querySelector(".despesa-label")?.classList.toggle("active",y.checked),s?.classList.toggle("hidden",!y.checked)}),p&&p.addEventListener("change",()=>{const s=u.querySelector("#edit-category-container");u.querySelector(".edit-receita-label")?.classList.toggle("active",!p.checked),u.querySelector(".edit-despesa-label")?.classList.toggle("active",p.checked),s?.classList.toggle("hidden",!p.checked)}),!e||!t||!n||!i||!o||!r||!d||!C||!_||!u||!A||!v||!O||!L||!J){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}e.addEventListener("submit",async s=>{s.preventDefault(),B();const a=Object.fromEntries(new FormData(e).entries());try{const c=await Z(a);W(c.token),window.location.hash="#/dashboard"}catch(c){b("login",c.message)}}),t.addEventListener("submit",async s=>{s.preventDefault(),B();const a=Object.fromEntries(new FormData(t).entries()),c=a.password;if(c.length<6||!/\d/.test(c)||!/[!@#$%^&*(),.?":{}|<>]/.test(c)){b("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}try{await Q(a),ge(),t.reset()}catch(l){b("register",l.message)}}),i.addEventListener("click",()=>{q(),window.location.hash="#/"}),r.addEventListener("click",()=>Se()),n.addEventListener("submit",async s=>{s.preventDefault();const a=new FormData(n),c=n.querySelector("#type-switch"),l={description:a.get("description"),amount:a.get("amount"),date:a.get("date"),type:c.checked?"despesa":"receita",category:c.checked?a.get("category"):null};try{await ee(l),n.reset(),n.querySelector("#category-container")?.classList.add("hidden"),S()}catch(m){alert(`Erro ao criar transação: ${m.message}`)}}),o.addEventListener("click",s=>{const a=s.target,c=a.closest(".edit-btn"),l=a.closest(".delete-btn");if(c){const m=parseInt(c.getAttribute("data-id"),10),g=c.getAttribute("data-description"),z=c.getAttribute("data-amount"),K=c.getAttribute("data-type"),G=c.getAttribute("data-date");fe({id:m,description:g,amount:z,type:K,date:G})}if(l){const m=parseInt(l.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&te(m).then(S).catch(g=>{alert(`Erro ao deletar transação: ${g.message}`)})}}),u.addEventListener("submit",async s=>{s.preventDefault();const a=new FormData(u),c=parseInt(a.get("transactionId"),10),l=u.querySelector("#edit-type-switch"),m={description:a.get("description"),amount:a.get("amount"),date:a.get("date"),type:l.checked?"despesa":"receita",category:l.checked?a.get("category"):null};console.log("FRONTEND-Enviando para UPDATE:",m);try{await ne(c,m),x(),S()}catch(g){alert(`Erro ao atualizar transação: ${g.message}`)}}),A.addEventListener("click",x),C.addEventListener("click",F),d.addEventListener("click",s=>s.target===d&&F()),O.addEventListener("click",N),v.addEventListener("click",async()=>{try{await oe(),N(),alert("Sua conta foi deletada com sucesso."),q(),window.location.hash="#/"}catch(s){alert(`Erro ao deletar conta: ${s.message}`)}}),L.addEventListener("input",()=>{v.disabled=L.value!=="CONFIRMAR"})};window.addEventListener("load",S);window.addEventListener("hashchange",S);document.addEventListener("DOMContentLoaded",Ee);
