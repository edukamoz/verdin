(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const h="verdin_auth_token",I=e=>{localStorage.setItem(h,e)},b=()=>localStorage.getItem(h),y=()=>{localStorage.removeItem(h)},P=()=>!!b(),F=void 0;throw new Error("VITE_API_URL não está definida no arquivo .env.local");const m=async(e,t={})=>{const n=b(),s={"Content-Type":"application/json"};n&&(s.Authorization=`Bearer ${n}`);const r=await fetch(`${F}${e}`,{...t,headers:{...s,...t.headers}});if(!r.ok){const o=await r.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(o.message||"Ocorreu um erro na requisição.")}return r.status===204||r.headers.get("content-length")==="0"?{success:!0}:r.json()},N=e=>m("/api/users/login",{method:"POST",body:JSON.stringify(e)}),R=e=>m("/api/users/register",{method:"POST",body:JSON.stringify(e)}),k=()=>m("/api/transactions"),x=e=>m("/api/transactions",{method:"POST",body:JSON.stringify(e)}),_=e=>m(`/api/transactions/${e}`,{method:"DELETE"}),E=document.querySelector("#auth-view"),S=document.querySelector("#app-view"),g=document.querySelector("#transactions-table tbody"),j=document.querySelector("#total-receitas"),B=document.querySelector("#total-despesas"),M=document.querySelector("#saldo-total"),v=document.querySelector("#login-error"),T=document.querySelector("#register-error"),f=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),U=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},V=e=>{if(g.innerHTML="",e.length===0){g.innerHTML='<tr><td colspan="4">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const n=document.createElement("tr"),s=t.type==="receita";n.innerHTML=`
      <td>${t.description}</td>
      <td class="${s?"receita":"despesa"}">${f(parseFloat(t.amount))}</td>
      <td>${U(t.date)}</td>
      <td>
        <button class="delete-btn" data-id="${t.id}">Excluir</button>
      </td>
    `,g.appendChild(n)})},z=e=>{const t=e.map(o=>parseFloat(o.amount)),n=t.filter((o,a)=>e[a].type==="receita").reduce((o,a)=>o+a,0),s=t.filter((o,a)=>e[a].type==="despesa").reduce((o,a)=>o+a,0),r=n-s;j.textContent=f(n),B.textContent=f(s),M.textContent=f(r)},w=e=>{e==="app"?(E.classList.add("hidden"),S.classList.remove("hidden")):(E.classList.remove("hidden"),S.classList.add("hidden"))},p=(e,t)=>{const n=e==="login"?v:T;n.textContent=t},L=()=>{v.textContent="",T.textContent=""};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),n=document.querySelector("#transaction-form"),s=document.querySelector("#logout-btn"),r=document.querySelector("#transactions-table");if(!e||!t||!n||!s||!r){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM. Verifique os IDs no seu index.html.");return}const o=async c=>{c.preventDefault(),L();const i=new FormData(e),d=Object.fromEntries(i.entries());try{const l=await N(d);I(l.token),await u()}catch(l){p("login",l.message)}},a=async c=>{c.preventDefault(),L();const i=new FormData(t),d=Object.fromEntries(i.entries()),l=d.password,C=/\d/.test(l),$=/[!@#$%^&*(),.?":{}|<>]/.test(l);if(l.length<6||!C||!$){p("register","A senha deve ter no mínimo 6 caracteres, um número e um caractere especial.");return}if(typeof d.password!="string"||d.password.length<6){p("register","A senha deve ser informada e ter no mínimo 6 caracteres.");return}try{await R(d),alert("Registro realizado com sucesso! Por favor, faça o login para continuar."),t.reset()}catch(A){p("register",A.message)}},D=()=>{y(),u()},q=async c=>{c.preventDefault();const i=new FormData(n),d={description:i.get("description"),amount:i.get("amount"),date:i.get("date"),type:i.get("type")};try{await x(d),n.reset(),await u()}catch(l){alert(`Erro ao criar transação: ${l.message}`)}},O=async c=>{const i=c.target;if(i.classList.contains("delete-btn")){const d=i.getAttribute("data-id");if(d&&confirm("Tem certeza que deseja deletar esta transação?"))try{await _(parseInt(d,10)),await u()}catch(l){alert(`Erro ao deletar transação: ${l.message}`)}}},u=async()=>{if(P()){w("app");try{const c=await k();V(c),z(c)}catch(c){console.error("Sessão inválida ou erro de rede. Deslogando...",c),y(),u()}}else w("auth")};e.addEventListener("submit",o),t.addEventListener("submit",a),s.addEventListener("click",D),n.addEventListener("submit",q),r.addEventListener("click",O),u()});
