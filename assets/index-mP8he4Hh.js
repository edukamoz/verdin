(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const D="verdin_auth_token",te=e=>{localStorage.setItem(D,e)},_=()=>localStorage.getItem(D),A=()=>{localStorage.removeItem(D)},M=()=>!!_(),oe="https://verdin-api.onrender.com",g=async(e,t={})=>{const a=_(),i={"Content-Type":"application/json"};a&&(i.Authorization=`Bearer ${a}`);const o=await fetch(`${oe}${e}`,{...t,headers:{...i,...t.headers}});if(!o.ok){const n=await o.json().catch(()=>({message:"Erro desconhecido."}));throw new Error(n.message||"Ocorreu um erro na requisição.")}return o.status===204||o.headers.get("content-length")==="0"?{success:!0}:o.json()},ne=e=>g("/api/users/login",{method:"POST",body:JSON.stringify(e)}),re=e=>g("/api/users/register",{method:"POST",body:JSON.stringify(e)}),se=()=>g("/api/transactions"),ae=e=>g("/api/transactions",{method:"POST",body:JSON.stringify(e)}),ce=e=>g(`/api/transactions/${e}`,{method:"DELETE"}),de=()=>g("/api/users/me",{method:"DELETE"}),ie=(e,t)=>g(`/api/transactions/${e}`,{method:"PUT",body:JSON.stringify(t)}),F=document.querySelector("#landing-view"),P=document.querySelector("#open-add-modal-btn"),N=document.querySelector("#auth-view"),j=document.querySelector("#app-view"),v=document.querySelector("#header-cta-btn"),C=document.querySelector("#transactions-table tbody"),le=document.querySelector("#total-receitas"),ue=document.querySelector("#total-despesas"),me=document.querySelector("#saldo-total"),E=document.querySelector("#login-error"),J=document.querySelector("#success-modal"),z=document.querySelector("#edit-modal"),pe=document.querySelector("#edit-transaction-id"),he=document.querySelector("#edit-description"),ye=document.querySelector("#edit-amount"),ge=document.querySelector("#edit-date"),K=document.querySelector("#delete-confirm-modal"),fe=document.querySelector("#delete-confirm-input"),Se=document.querySelector("#final-delete-btn"),Z=document.querySelector("#add-transaction-modal"),q=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),we=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("pt-BR")},ve=e=>{if(C.innerHTML="",e.length===0){C.innerHTML='<tr><td colspan="5">Nenhuma transação encontrada.</td></tr>';return}e.forEach(t=>{const a=document.createElement("tr"),i=t.type==="receita",o=t.type==="despesa"?t.category||"Outras":"---",n='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>',d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.716c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>';a.innerHTML=`
      <td>${o}</td>
      <td>${t.description}</td>
      <td class="${i?"receita":"despesa"}">${q(parseFloat(t.amount))}</td>
      <td>${we(t.date)}</td>
      <td>
        <button class="edit-btn" title="Editar" 
          data-id="${t.id}"
          data-description="${t.description}"
          data-amount="${t.amount}"
          data-type="${t.type}"
          data-date="${t.date.split("T")[0]}"
          data-category="${t.category||""}">
          ${n}
        </button>
        <button class="delete-btn" title="Excluir" data-id="${t.id}">
          ${d}
        </button>
      </td>
    `,C.appendChild(a)})},Le=e=>{const t=e.map(n=>parseFloat(n.amount)),a=t.filter((n,d)=>e[d].type==="receita").reduce((n,d)=>n+d,0),i=t.filter((n,d)=>e[d].type==="despesa").reduce((n,d)=>n+d,0),o=a-i;le.textContent=q(a),ue.textContent=q(i),me.textContent=q(o)},I=e=>{F.classList.add("hidden"),N.classList.add("hidden"),j.classList.add("hidden"),P.classList.add("hidden"),e==="landing"?F.classList.remove("hidden"):e==="auth"?N.classList.remove("hidden"):e==="app"&&(j.classList.remove("hidden"),P.classList.remove("hidden"))},qe=e=>{E&&(E.textContent=e)},Ee=()=>{E&&(E.textContent=""),document.querySelectorAll("#register-form .error-message-inline").forEach(e=>{e.textContent=""})},be=()=>{J.classList.remove("hidden")},H=()=>{J.classList.add("hidden")},ke=e=>{pe.value=e.id.toString(),he.value=e.description,ye.value=parseFloat(e.amount).toFixed(2),ge.value=e.date.split("T")[0];const t=document.querySelector("#edit-type-switch");t.checked=e.type==="despesa";const a=document.querySelector("#edit-category-container"),i=document.querySelector("#edit-category");document.querySelector(".edit-receita-label").classList.toggle("active",e.type==="receita"),document.querySelector(".edit-despesa-label").classList.toggle("active",e.type==="despesa"),e.type==="despesa"?(a.classList.remove("hidden"),i.value=e.category||"Outras"):a.classList.add("hidden"),z.classList.remove("hidden")},R=()=>{z.classList.add("hidden")},Ce=()=>{K.classList.remove("hidden")},U=()=>{fe.value="",Se.disabled=!0,K.classList.add("hidden")},Te=e=>{v&&(e?(v.textContent="Meu Dashboard",v.href="#/dashboard"):(v.textContent="Acessar Plataforma",v.href="#/auth"))},Ae=()=>{Z.classList.remove("hidden")},T=()=>{Z.classList.add("hidden")},V='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>',Me='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243L6.228 6.228" /></svg>',De={"#/auth":()=>I("auth"),"#/dashboard":()=>Ie()},L=()=>{Te(M());const e=window.location.hash||"#/";if(M()&&e==="#/auth"){window.location.hash="#/dashboard";return}const t=De[e];t?t():I("landing")},Ie=async()=>{if(!M()){window.location.hash="#/auth";return}I("app");try{const e=await se();ve(e),Le(e)}catch(e){console.error("Sessão inválida ou erro de rede. Deslogando...",e),A(),window.location.hash="#/auth"}},xe=()=>{const e=document.querySelector("#login-form"),t=document.querySelector("#register-form"),a=document.querySelector("#transaction-form"),i=document.querySelector("#logout-btn"),o=document.querySelector("#transactions-table"),n=document.querySelector("#delete-account-btn"),d=document.querySelector("#success-modal"),x=document.querySelector("#close-modal-btn"),G=document.querySelector("#edit-modal"),m=document.querySelector("#edit-transaction-form"),O=document.querySelector("#cancel-edit-btn"),b=document.querySelector("#final-delete-btn"),$=document.querySelector("#cancel-delete-account-btn"),k=document.querySelector("#delete-confirm-input"),W=document.querySelector("#delete-confirm-modal"),f=a.querySelector("#type-switch"),w=m.querySelector("#edit-type-switch"),Y=document.querySelector("#open-add-modal-btn"),Q=document.querySelector("#cancel-add-btn"),B=document.querySelector("#add-transaction-modal");if(f&&f.addEventListener("change",()=>{console.log("--- DEBUG: Switch de NOVA TRANSAÇÃO foi alterado! ---"),console.log("Está marcado (é despesa)?",f.checked);const r=a?.querySelector("#category-container");console.log("Elemento do container de categoria encontrado:",r),a?.querySelector(".receita-label")?.classList.toggle("active",!f.checked),a?.querySelector(".despesa-label")?.classList.toggle("active",f.checked),r?.classList.toggle("hidden",!f.checked)}),w&&w.addEventListener("change",()=>{const r=m.querySelector("#edit-category-container");m.querySelector(".edit-receita-label")?.classList.toggle("active",!w.checked),m.querySelector(".edit-despesa-label")?.classList.toggle("active",w.checked),r?.classList.toggle("hidden",!w.checked)}),!e||!t||!a||!i||!o||!n||!d||!x||!G||!m||!O||!b||!$||!k||!W){console.error("Erro crítico: Um ou mais elementos essenciais não foram encontrados no DOM.");return}Y.addEventListener("click",Ae),Q.addEventListener("click",T),B.addEventListener("click",r=>{r.target===B&&T()});const X=()=>{document.querySelectorAll(".password-toggle-icon").forEach(r=>{r.innerHTML=V,r.addEventListener("click",()=>{const s=r.dataset.target;if(!s)return;const c=document.querySelector(`#${s}`);if(!c)return;const l=c.type==="password";c.type=l?"text":"password",r.innerHTML=l?Me:V})})};e.addEventListener("submit",async r=>{r.preventDefault(),Ee();const s=Object.fromEntries(new FormData(e).entries());try{const c=await ne(s);te(c.token),window.location.hash="#/dashboard"}catch(c){qe(c.message)}});const ee=async r=>{r.preventDefault();let s=!0;document.querySelectorAll(".error-message-inline").forEach(y=>y.textContent="");const c=document.querySelector("#register-name"),l=document.querySelector("#register-email"),u=document.querySelector("#register-password"),p=document.querySelector("#register-password-confirm");c.value.trim()===""&&(document.querySelector("#name-error").textContent="O nome é obrigatório.",s=!1),l.value.trim()===""?(document.querySelector("#email-error").textContent="O e-mail é obrigatório.",s=!1):/\S+@\S+\.\S+/.test(l.value)||(document.querySelector("#email-error").textContent="Formato de e-mail inválido.",s=!1);const S=u.value,h=[];if(S.length<8&&h.push("8 caracteres"),/\d/.test(S)||h.push("um número"),/[!@#$%^&*(),.?":{}|<>]/.test(S)||h.push("um caractere especial"),h.length>0&&(document.querySelector("#password-error").textContent=`A senha precisa ter no mínimo: ${h.join(", ")}.`,s=!1),p.value!==S&&(document.querySelector("#password-confirm-error").textContent="As senhas não coincidem.",s=!1),!!s)try{const y={name:c.value,email:l.value,password:u.value};await re(y),be(),t.reset()}catch(y){document.querySelector("#email-error").textContent=y.message}};t.addEventListener("submit",ee),X(),i.addEventListener("click",()=>{A(),window.location.hash="#/"}),n.addEventListener("click",()=>Ce()),a.addEventListener("submit",async r=>{r.preventDefault();const s=new FormData(a),c=a.querySelector("#type-switch"),l={description:s.get("description"),amount:s.get("amount"),date:s.get("date"),type:c.checked?"despesa":"receita",category:c.checked?s.get("category"):null};try{await ae(l),a.reset(),T(),L()}catch(u){alert(`Erro ao criar transação: ${u.message}`)}}),o.addEventListener("click",r=>{const s=r.target,c=s.closest(".edit-btn"),l=s.closest(".delete-btn");if(c){const u=parseInt(c.getAttribute("data-id"),10),p=c.getAttribute("data-description"),S=c.getAttribute("data-amount"),h=c.getAttribute("data-type"),y=c.getAttribute("data-date");ke({id:u,description:p,amount:S,type:h,date:y})}if(l){const u=parseInt(l.getAttribute("data-id"),10);confirm("Tem certeza que deseja deletar esta transação?")&&ce(u).then(L).catch(p=>{alert(`Erro ao deletar transação: ${p.message}`)})}}),m.addEventListener("submit",async r=>{r.preventDefault();const s=new FormData(m),c=parseInt(s.get("transactionId"),10),l=m.querySelector("#edit-type-switch"),u={description:s.get("description"),amount:s.get("amount"),date:s.get("date"),type:l.checked?"despesa":"receita",category:l.checked?s.get("category"):null};console.log("FRONTEND-Enviando para UPDATE:",u);try{await ie(c,u),R(),L()}catch(p){alert(`Erro ao atualizar transação: ${p.message}`)}}),O.addEventListener("click",R),x.addEventListener("click",H),d.addEventListener("click",r=>r.target===d&&H()),$.addEventListener("click",U),b.addEventListener("click",async()=>{try{await de(),U(),alert("Sua conta foi deletada com sucesso."),A(),window.location.hash="#/"}catch(r){alert(`Erro ao deletar conta: ${r.message}`)}}),k.addEventListener("input",()=>{b.disabled=k.value!=="CONFIRMAR"})};window.addEventListener("load",L);window.addEventListener("hashchange",L);document.addEventListener("DOMContentLoaded",xe);
